# Stripe Payment Integration Research

**Generated**: 2025-08-15T10:28:32.058612
**Task**: Create comprehensive Stripe subscription billing integration for Fed Job Advisor with Local /month and Mobile /month tiers
**Type**: subscription_management

## Fed Job Advisor Pricing
- **Local**: $29/month (50-mile radius)
- **Mobile**: $49/month (nationwide access)

## Implementation Plan
Stripe subscription_management implementation

### Steps
1. Create Stripe products and prices for Local/Mobile tiers
2. Implement customer creation endpoint
3. Create checkout session for subscription
4. Handle success/cancel redirects
5. Implement webhook handler for subscription events
6. Store subscription status in database

### API Endpoints
- `POST /api/v1/payments/create-checkout-session`
- `POST /api/v1/payments/customer-portal`
- `POST /api/v1/webhooks/stripe`
- `GET /api/v1/payments/subscription-status`

## Code Templates
### create_checkout
```python

@router.post("/create-checkout-session")
async def create_checkout_session(
    tier: str,  # 'local' or 'mobile'
    user: User = Depends(get_current_user)
):
    # Get or create Stripe customer
    if not user.stripe_customer_id:
        customer = stripe.Customer.create(
            email=user.email,
            metadata={"user_id": str(user.id)}
        )
        user.stripe_customer_id = customer.id
        await db.commit()
    
    # Determine price based on tier
    price_id = "price_local_monthly" if tier == "local" else "price_mobile_monthly"
    
    # Create checkout session
    session = stripe.checkout.Session.create(
        customer=user.stripe_customer_id,
        payment_method_types=['card'],
        line_items=[{'price': price_id, 'quantity': 1}],
        mode='subscription',
        success_url=f"{FRONTEND_URL}/payment/success?session_id={{CHECKOUT_SESSION_ID}}",
        cancel_url=f"{FRONTEND_URL}/payment/cancel",
        metadata={"user_id": str(user.id), "tier": tier}
    )
    
    return {"checkout_url": session.url}

```

## Launch Checklist
- [ ] Create products and prices in Stripe Dashboard
- [ ] Set up webhook endpoint
- [ ] Configure success/cancel URLs
- [ ] Test full payment flow
- [ ] Enable production keys
